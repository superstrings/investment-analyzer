# 需求设计文档

> Investment Analyzer - 投资分析自动化系统

## 1. 项目背景

### 1.1 项目目标

构建一个本地化的投资分析工具，整合多数据源、技术分析和报告生成，支持个人投资者进行系统化的投资决策。

### 1.2 核心价值

- **数据整合**: 统一管理多市场 (港股/美股/A股) 投资数据
- **技术分析**: 自动计算技术指标，识别交易形态
- **风险评估**: 量化组合风险，提供分散化建议
- **决策支持**: 生成专业报告，辅助投资决策

## 2. 功能需求

### 2.1 数据采集 (M2)

| 功能 | 优先级 | 状态 |
|------|--------|------|
| 富途持仓同步 | P0 | ✅ 完成 |
| 富途交易记录 | P0 | ✅ 完成 |
| K线数据采集 (akshare) | P0 | ✅ 完成 |
| CSV 数据导入 | P1 | ✅ 完成 |
| 增量同步 | P1 | ✅ 完成 |

### 2.2 技术分析 (M4)

| 功能 | 优先级 | 状态 |
|------|--------|------|
| 移动平均线 (SMA/EMA/WMA) | P0 | ✅ 完成 |
| RSI 指标 | P0 | ✅ 完成 |
| MACD 指标 | P0 | ✅ 完成 |
| 布林带 | P0 | ✅ 完成 |
| OBV 能量潮 | P0 | ✅ 完成 |
| VCP 形态识别 | P1 | ✅ 完成 |
| 背离检测 | P2 | ✅ 完成 |

### 2.3 组合分析 (M4)

| 功能 | 优先级 | 状态 |
|------|--------|------|
| 仓位权重计算 | P0 | ✅ 完成 |
| 盈亏分析 | P0 | ✅ 完成 |
| 市场配比 | P0 | ✅ 完成 |
| HHI 集中度指数 | P1 | ✅ 完成 |
| 风险信号生成 | P1 | ✅ 完成 |

### 2.4 图表生成 (M3)

| 功能 | 优先级 | 状态 |
|------|--------|------|
| K线图 | P0 | ✅ 完成 |
| 均线叠加 | P0 | ✅ 完成 |
| 成交量面板 | P0 | ✅ 完成 |
| 批量生成 | P1 | ✅ 完成 |
| 多种样式 | P1 | ✅ 完成 |

### 2.5 报告生成 (M6)

| 功能 | 优先级 | 状态 |
|------|--------|------|
| 组合报告 | P1 | ✅ 完成 |
| 技术分析报告 | P1 | ✅ 完成 |
| 每日简报 | P2 | ✅ 完成 |
| 周度回顾 | P2 | ✅ 完成 |
| 多格式输出 | P1 | ✅ 完成 |

## 3. 非功能需求

### 3.1 性能要求

- K线数据获取: < 3 秒/股票
- 图表生成: < 2 秒/张
- 报告生成: < 1 秒/份
- 数据库查询: < 100ms

### 3.2 可靠性要求

- 数据采集失败自动重试
- 数据库连接池管理
- 异常日志记录
- 测试覆盖率 > 80%

### 3.3 可维护性要求

- 模块化架构
- 类型注解
- 统一代码风格 (Black/isort)
- 完整文档

### 3.4 安全要求

- 敏感信息环境变量管理
- 交易密码加密存储
- 无远程数据泄露

## 4. 用户故事

### 4.1 数据同步

```
作为投资者
我想要自动同步富途持仓和交易记录
以便随时查看最新投资状态
```

验收标准:
- [x] 支持港股/美股账户
- [x] 支持增量同步
- [x] 同步日志记录

### 4.2 技术分析

```
作为投资者
我想要对持仓股票进行技术分析
以便评估买卖时机
```

验收标准:
- [x] 计算常用技术指标
- [x] 检测 VCP 形态
- [x] 生成技术信号

### 4.3 组合分析

```
作为投资者
我想要分析投资组合的风险
以便及时调整仓位配置
```

验收标准:
- [x] 计算仓位权重
- [x] 评估集中度风险
- [x] 生成风险信号

### 4.4 报告生成

```
作为投资者
我想要生成投资分析报告
以便系统化记录和回顾投资决策
```

验收标准:
- [x] 支持多种报告类型
- [x] 支持多种输出格式
- [x] 嵌入图表和数据表

## 5. 约束条件

### 5.1 技术约束

- Python 3.12+ (asdf 管理)
- PostgreSQL 17 (Homebrew)
- 本地运行 (无云服务)
- CLI 交互 (无 Web 界面)

### 5.2 数据约束

- 富途 API 需要本地客户端
- akshare 依赖网络连接
- 历史数据量有限

### 5.3 时间约束

- M1-M6 阶段: 2025-12-14 完成

## 6. 验收标准

| 里程碑 | 验收标准 | 状态 |
|--------|----------|------|
| M1 | 项目结构、配置、数据库初始化 | ✅ |
| M2 | 数据采集、同步服务、CSV导入 | ✅ |
| M3 | K线图生成、批量图表 | ✅ |
| M4 | 技术指标、VCP识别、组合分析 | ✅ |
| M5 | Claude Skills 文档 | ✅ |
| M6 | 报告生成器 | ✅ |

---

*文档版本: 1.0*
*最后更新: 2025-12-14*
